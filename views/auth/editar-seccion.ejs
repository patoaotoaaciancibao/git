<!-- views/auth/editar-seccion.ejs -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Editar Sección</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/css/style.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
</head>
<body>

<%- include('../partials/navbar') %>

<div class="container py-5">
  <!-- Mensajes Flash -->
  <% if (messages.error) { %>
    <div class="alert alert-danger">
      <% messages.error.forEach(err => { %>
        <div>⚠️ <%= err %></div>
      <% }) %>
    </div>
  <% } %>
  <% if (messages.success) { %>
    <div class="alert alert-success">
      <% messages.success.forEach(msg => { %>
        <div>✅ <%= msg %></div>
      <% }) %>
    </div>
  <% } %>

  <h1 class="mb-4">Editar Sección</h1>

  <!-- Formulario de título y portada -->
  <form 
    action="/auth/curso/<%= idCurso %>/editar-seccion/<%= seccion.id_seccion %>" 
    method="POST" 
    enctype="multipart/form-data"
    class="mb-5"
  >
    <div class="mb-3">
      <label for="titulo" class="form-label">Título de la Sección</label>
      <input 
        type="text" 
        id="titulo" 
        name="titulo" 
        class="form-control" 
        value="<%= seccion.titulo %>" 
        required 
      />
    </div>

    <div class="mb-3">
      <label class="form-label">Portada Actual</label><br/>
      <% if (seccion.portada) { %>
        <img 
          src="/assets/secciones/<%= seccion.portada %>" 
          alt="Portada sección" 
          class="img-thumbnail" 
          style="max-width:200px;" 
        />
      <% } else { %>
        <p class="text-muted">Sin portada</p>
      <% } %>
    </div>

    <div class="mb-3">
      <label for="portada" class="form-label">Cambiar Portada</label>
      <input 
        type="file" 
        id="portada" 
        name="portada" 
        accept=".png,.jpg,.jpeg,.gif" 
        class="form-control" 
      />
      <small class="form-text text-muted">
        PNG, JPG, JPEG o GIF. Si no subes nada, se mantiene la actual.
      </small>
    </div>

    <button type="submit" class="btn btn-primary">
      <i class="fas fa-save me-1"></i> Guardar Cambios
    </button>
  </form>

  <!-- Sección de vídeo -->
  <h4 class="mb-3">Vídeo de la sección</h4>

<% if (seccion.video) { %>
  <div class="mb-3">
    <video 
      width="100%" 
      controls 
      style="max-width:600px; display:block; margin-bottom:1rem;"
    >
      <source 
        src="/videos/<%= seccion.id_seccion %>/<%= seccion.video %>" 
        type="video/mp4" 
      />
      Tu navegador no soporta reproducción de vídeo.
    </video>
  </div>
<% } else { %>
  <p class="text-muted mb-3">No hay vídeo subido.</p>
<% } %>

  <form 
    action="/auth/curso/<%= idCurso %>/editar-seccion/<%= seccion.id_seccion %>/video" 
    method="POST" 
    enctype="multipart/form-data"
  >
    <div class="mb-3">
      <label for="video" class="form-label">Subir Vídeo</label>
      <input 
        type="file" 
        id="video" 
        name="video" 
        accept=".mp4,.webm" 
        class="form-control" 
        required
      />
      <small class="form-text text-muted">
        Formatos permitidos: MP4, WEBM. Máx. 3 MB.
      </small>
    </div>
    <button type="submit" class="btn btn-success">
      <i class="fas fa-upload me-1"></i> Subir Vídeo
    </button>
  </form>

  <div class="mt-4">
    <a href="/auth/curso/<%= idCurso %>" class="btn btn-outline-secondary">
      ← Volver al curso
    </a>
  </div>
</div>

<%- include('../partials/footer') %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
